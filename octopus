
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OCTOPUS ‚Äî Communication Invisible ASEMANTIX</title>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        .octopus-logo { width: 150px; height: 150px; margin-bottom: 15px; filter: drop-shadow(0 0 20px rgba(138, 43, 226, 0.5)); }
        .octopus-logo-small { width: 100px; height: 100px; margin-bottom: 10px; filter: drop-shadow(0 0 15px rgba(138, 43, 226, 0.4)); }
        body { font-family: 'Segoe UI', system-ui, sans-serif; background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #0a0a0a 100%); min-height: 100vh; color: #fff; }
        .container { max-width: 900px; margin: 0 auto; padding: 20px; }
        .pin-screen, .setup-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #0a0a0a 100%); display: flex; justify-content: center; align-items: center; z-index: 1000; }
        .pin-screen.hidden, .setup-screen.hidden { display: none; }
        .pin-box, .setup-box { background: rgba(0,0,0,0.5); border: 1px solid rgba(138, 43, 226, 0.3); border-radius: 20px; padding: 40px; text-align: center; max-width: 400px; width: 90%; }
        .pin-title { font-size: 1.5rem; color: #8a2be2; margin-bottom: 10px; }
        .pin-subtitle { color: #888; margin-bottom: 30px; font-size: 0.9rem; }
        .pin-input, .setup-input { width: 100%; padding: 15px; font-size: 1.5rem; text-align: center; background: rgba(0,0,0,0.5); border: 1px solid rgba(138, 43, 226, 0.3); border-radius: 10px; color: #fff; margin-bottom: 15px; }
        .pin-input:focus, .setup-input:focus { outline: none; border-color: #8a2be2; }
        .pin-error { color: #ef4444; margin-bottom: 15px; display: none; }
        .pin-btn { width: 100%; padding: 15px; background: linear-gradient(135deg, #8a2be2, #6a1bb2); border: none; border-radius: 10px; color: #fff; font-size: 1rem; cursor: pointer; }
        .pin-btn:hover { transform: translateY(-2px); box-shadow: 0 5px 20px rgba(138, 43, 226, 0.4); }
        .pin-setup-text { color: #888; font-size: 0.85rem; margin-top: 20px; }
        .header { text-align: center; padding: 20px 0; border-bottom: 1px solid rgba(138, 43, 226, 0.3); margin-bottom: 20px; }
        .title { font-size: 2rem; color: #8a2be2; letter-spacing: 0.3rem; }
        .subtitle { color: #888; margin-top: 5px; }
        .badge { display: inline-block; background: rgba(138, 43, 226, 0.2); border: 1px solid #8a2be2; border-radius: 20px; padding: 5px 15px; margin-top: 15px; font-size: 0.85rem; color: #8a2be2; }
        .status-bar { display: flex; justify-content: space-between; align-items: center; background: rgba(0,0,0,0.3); border-radius: 10px; padding: 15px 20px; margin-bottom: 20px; flex-wrap: wrap; gap: 10px; }
        .status-badge { display: flex; align-items: center; gap: 8px; padding: 8px 16px; border-radius: 20px; font-size: 0.9rem; }
        .status-badge.connected { background: rgba(138, 43, 226, 0.2); color: #8a2be2; }
        .status-badge.disconnected { background: rgba(239, 68, 68, 0.2); color: #ef4444; }
        .status-dot { width: 10px; height: 10px; border-radius: 50%; animation: pulse 2s infinite; }
        .status-dot.connected { background: #8a2be2; }
        .status-dot.disconnected { background: #ef4444; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .member-id { background: rgba(212, 175, 55, 0.2); color: #d4af37; padding: 8px 16px; border-radius: 20px; font-weight: 600; }
        .protocol-info { background: rgba(16, 185, 129, 0.1); border: 1px solid rgba(16, 185, 129, 0.3); border-radius: 10px; padding: 15px; margin-bottom: 20px; font-size: 0.85rem; }
        .protocol-info h4 { color: #10b981; margin-bottom: 10px; }
        .protocol-info code { background: rgba(0,0,0,0.3); padding: 2px 6px; border-radius: 4px; color: #d4af37; }
        .seed-section, .chat-section, .stats-section { background: rgba(0,0,0,0.3); border-radius: 15px; padding: 25px; margin-bottom: 20px; border: 1px solid rgba(255,255,255,0.1); }
        .section-title { color: #8a2be2; font-size: 1.1rem; margin-bottom: 15px; display: flex; align-items: center; gap: 10px; }
        .section-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; flex-wrap: wrap; gap: 10px; }
        .seed-input-group { display: flex; gap: 10px; margin-bottom: 15px; flex-wrap: wrap; }
        .seed-input-group input[type="text"] { flex: 1; min-width: 200px; background: rgba(0,0,0,0.5); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; padding: 12px 15px; color: #fff; font-family: monospace; font-size: 0.85rem; }
        .seed-input-group input:focus { outline: none; border-color: #8a2be2; }
        .btn { padding: 12px 20px; border: none; border-radius: 8px; font-size: 0.95rem; cursor: pointer; transition: all 0.3s; }
        .btn-primary { background: linear-gradient(135deg, #8a2be2, #6a1bb2); color: #fff; }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 5px 20px rgba(138, 43, 226, 0.4); }
        .btn-secondary { background: rgba(255,255,255,0.1); color: #fff; border: 1px solid rgba(255,255,255,0.2); }
        .btn-danger { background: rgba(239, 68, 68, 0.2); color: #ef4444; border: 1px solid rgba(239, 68, 68, 0.3); }
        .seed-status { display: flex; align-items: center; gap: 10px; padding: 10px 15px; background: rgba(138, 43, 226, 0.1); border-radius: 8px; color: #8a2be2; font-size: 0.9rem; }
        .seed-status.not-loaded { background: rgba(239, 68, 68, 0.1); color: #ef4444; }
        .messages-container { height: 300px; overflow-y: auto; background: rgba(0,0,0,0.3); border-radius: 10px; padding: 15px; margin-bottom: 20px; }
        .message { margin-bottom: 15px; padding: 12px 15px; border-radius: 10px; max-width: 85%; }
        .message.sent { background: linear-gradient(135deg, #8a2be2, #6a1bb2); margin-left: auto; text-align: right; }
        .message.received { background: rgba(212, 175, 55, 0.2); border: 1px solid rgba(212, 175, 55, 0.3); }
        .message-header { font-size: 0.75rem; opacity: 0.7; margin-bottom: 5px; }
        .message-content { word-wrap: break-word; }
        .message-fragment { font-family: monospace; font-size: 0.65rem; opacity: 0.5; margin-top: 8px; word-break: break-all; }
        .message-validation { font-size: 0.7rem; margin-top: 5px; color: #10b981; }
        .no-messages { text-align: center; color: #666; padding: 50px; }
        .input-section { display: flex; gap: 10px; flex-wrap: wrap; }
        .message-input { flex: 1; min-width: 200px; background: rgba(0,0,0,0.5); border: 1px solid rgba(255,255,255,0.2); border-radius: 10px; padding: 15px; color: #fff; font-size: 1rem; resize: none; }
        .message-input:focus { outline: none; border-color: #8a2be2; }
        .message-input:disabled { opacity: 0.5; }
        .send-btn { padding: 15px 30px; background: linear-gradient(135deg, #8a2be2, #6a1bb2); border: none; border-radius: 10px; color: #fff; font-size: 1rem; cursor: pointer; }
        .send-btn:disabled { opacity: 0.5; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 10px; }
        .stat-item { background: rgba(0,0,0,0.3); border-radius: 10px; padding: 15px; text-align: center; }
        .stat-value { font-size: 1.3rem; font-weight: 700; color: #8a2be2; }
        .stat-label { font-size: 0.7rem; color: #888; margin-top: 5px; }
        .footer { text-align: center; padding: 20px; margin-top: 30px; border-top: 1px solid rgba(255,255,255,0.1); color: #666; font-size: 0.8rem; }
        .footer a { color: #8a2be2; text-decoration: none; margin: 0 10px; }
        #seedFileInput { display: none; }
    </style>
</head>
<body>
    <!-- PIN Screen -->
    <div id="pinScreen" class="pin-screen">
        <div class="pin-box">
            <svg class="octopus-logo" viewBox="0 0 400 400" xmlns="http://www.w3.org/2000/svg">
                <defs>
                    <radialGradient id="bg1" cx="50%" cy="30%" r="60%"><stop offset="0%" stop-color="#b366e8"/><stop offset="100%" stop-color="#4a0080"/></radialGradient>
                    <linearGradient id="tg1" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#9b4dca"/><stop offset="50%" stop-color="#6a1bb2"/><stop offset="100%" stop-color="#3d0066"/></linearGradient>
                    <filter id="gl1"><feGaussianBlur stdDeviation="2" result="coloredBlur"/><feMerge><feMergeNode in="coloredBlur"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
                </defs>
                <path d="M150,200 C100,180 50,220 30,280 C10,340 50,390 120,380 C180,370 220,340 250,300 C270,270 300,250 340,260 C380,270 395,310 380,350 C365,390 320,400 280,390" fill="none" stroke="url(#tg1)" stroke-width="22" stroke-linecap="round" filter="url(#gl1)"/>
                <path d="M150,200 C100,180 50,220 30,280 C10,340 50,390 120,380 C180,370 220,340 250,300 C270,270 300,250 340,260 C380,270 395,310 380,350 C365,390 320,400 280,390" fill="none" stroke="#2d0a4e" stroke-width="8" stroke-linecap="round" stroke-dasharray="2,15"/>
                <path d="M250,200 C300,180 350,150 370,100 C385,50 350,10 290,20 C230,30 180,60 150,100 C120,140 80,130 50,100 C20,70 10,30 30,10" fill="none" stroke="url(#tg1)" stroke-width="20" stroke-linecap="round" filter="url(#gl1)"/>
                <path d="M250,200 C300,180 350,150 370,100 C385,50 350,10 290,20 C230,30 180,60 150,100 C120,140 80,130 50,100 C20,70 10,30 30,10" fill="none" stroke="#2d0a4e" stroke-width="6" stroke-linecap="round" stroke-dasharray="2,12"/>
                <path d="M180,220 C150,260 100,300 80,350 C60,400 100,420 160,400 C220,380 280,400 340,420 C400,440 420,400 400,350" fill="none" stroke="url(#tg1)" stroke-width="18" stroke-linecap="round" filter="url(#gl1)"/>
                <path d="M180,220 C150,260 100,300 80,350 C60,400 100,420 160,400 C220,380 280,400 340,420 C400,440 420,400 400,350" fill="none" stroke="#2d0a4e" stroke-width="5" stroke-linecap="round" stroke-dasharray="2,10"/>
                <path d="M260,190 C310,170 360,200 380,250 C400,300 390,360 350,380 C310,400 260,380 240,340" fill="none" stroke="url(#tg1)" stroke-width="16" stroke-linecap="round" filter="url(#gl1)"/>
                <path d="M260,190 C310,170 360,200 380,250 C400,300 390,360 350,380 C310,400 260,380 240,340" fill="none" stroke="#2d0a4e" stroke-width="5" stroke-linecap="round" stroke-dasharray="2,10"/>
                <path d="M140,190 C90,170 40,200 20,250 C0,300 10,360 50,380 C90,400 140,380 160,340" fill="none" stroke="url(#tg1)" stroke-width="16" stroke-linecap="round" filter="url(#gl1)"/>
                <path d="M140,190 C90,170 40,200 20,250 C0,300 10,360 50,380 C90,400 140,380 160,340" fill="none" stroke="#2d0a4e" stroke-width="5" stroke-linecap="round" stroke-dasharray="2,10"/>
                <path d="M200,150 C200,100 240,60 280,40 C320,20 370,40 380,80 C390,120 360,150 320,160" fill="none" stroke="url(#tg1)" stroke-width="14" stroke-linecap="round" filter="url(#gl1)"/>
                <path d="M180,150 C160,100 120,60 80,40 C40,20 10,50 10,90 C10,130 40,160 80,165" fill="none" stroke="url(#tg1)" stroke-width="14" stroke-linecap="round" filter="url(#gl1)"/>
                <path d="M220,210 C250,230 280,280 260,320 C240,360 200,370 170,350" fill="none" stroke="url(#tg1)" stroke-width="12" stroke-linecap="round" filter="url(#gl1)"/>
                <ellipse cx="200" cy="180" rx="70" ry="60" fill="url(#bg1)" filter="url(#gl1)"/>
                <ellipse cx="200" cy="145" rx="45" ry="40" fill="url(#bg1)"/>
                <ellipse cx="175" cy="175" rx="18" ry="22" fill="#0a0015"/>
                <ellipse cx="225" cy="175" rx="18" ry="22" fill="#0a0015"/>
                <ellipse cx="175" cy="175" rx="18" ry="22" fill="none" stroke="#8a2be2" stroke-width="2" opacity="0.5"/>
                <ellipse cx="225" cy="175" rx="18" ry="22" fill="none" stroke="#8a2be2" stroke-width="2" opacity="0.5"/>
                <ellipse cx="178" cy="172" rx="7" ry="9" fill="#bf5fff"/>
                <ellipse cx="228" cy="172" rx="7" ry="9" fill="#bf5fff"/>
                <circle cx="172" cy="168" r="4" fill="#fff" opacity="0.9"/>
                <circle cx="222" cy="168" r="4" fill="#fff" opacity="0.9"/>
            </svg>
            <div class="pin-title">OCTOPUS</div>
            <div class="pin-subtitle" id="pinSubtitle">Entrez votre code PIN</div>
            <input type="password" id="pinInput" class="pin-input" maxlength="4" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢" inputmode="numeric">
            <div class="pin-error" id="pinError">Code PIN incorrect</div>
            <button class="pin-btn" onclick="checkPin()">üîì D√©verrouiller</button>
            <div class="pin-setup-text" id="pinSetupText"></div>
        </div>
    </div>
    
    <!-- Setup Screen -->
    <div id="setupScreen" class="setup-screen hidden">
        <div class="setup-box">
            <svg class="octopus-logo" viewBox="0 0 400 400" xmlns="http://www.w3.org/2000/svg">
                <defs>
                    <radialGradient id="bg2" cx="50%" cy="30%" r="60%"><stop offset="0%" stop-color="#b366e8"/><stop offset="100%" stop-color="#4a0080"/></radialGradient>
                    <linearGradient id="tg2" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#9b4dca"/><stop offset="50%" stop-color="#6a1bb2"/><stop offset="100%" stop-color="#3d0066"/></linearGradient>
                    <filter id="gl2"><feGaussianBlur stdDeviation="2" result="coloredBlur"/><feMerge><feMergeNode in="coloredBlur"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
                </defs>
                <path d="M150,200 C100,180 50,220 30,280 C10,340 50,390 120,380 C180,370 220,340 250,300 C270,270 300,250 340,260 C380,270 395,310 380,350 C365,390 320,400 280,390" fill="none" stroke="url(#tg2)" stroke-width="22" stroke-linecap="round" filter="url(#gl2)"/>
                <path d="M150,200 C100,180 50,220 30,280 C10,340 50,390 120,380 C180,370 220,340 250,300 C270,270 300,250 340,260 C380,270 395,310 380,350 C365,390 320,400 280,390" fill="none" stroke="#2d0a4e" stroke-width="8" stroke-linecap="round" stroke-dasharray="2,15"/>
                <path d="M250,200 C300,180 350,150 370,100 C385,50 350,10 290,20 C230,30 180,60 150,100 C120,140 80,130 50,100 C20,70 10,30 30,10" fill="none" stroke="url(#tg2)" stroke-width="20" stroke-linecap="round" filter="url(#gl2)"/>
                <path d="M180,220 C150,260 100,300 80,350 C60,400 100,420 160,400 C220,380 280,400 340,420 C400,440 420,400 400,350" fill="none" stroke="url(#tg2)" stroke-width="18" stroke-linecap="round" filter="url(#gl2)"/>
                <path d="M260,190 C310,170 360,200 380,250 C400,300 390,360 350,380 C310,400 260,380 240,340" fill="none" stroke="url(#tg2)" stroke-width="16" stroke-linecap="round" filter="url(#gl2)"/>
                <path d="M140,190 C90,170 40,200 20,250 C0,300 10,360 50,380 C90,400 140,380 160,340" fill="none" stroke="url(#tg2)" stroke-width="16" stroke-linecap="round" filter="url(#gl2)"/>
                <path d="M200,150 C200,100 240,60 280,40 C320,20 370,40 380,80 C390,120 360,150 320,160" fill="none" stroke="url(#tg2)" stroke-width="14" stroke-linecap="round" filter="url(#gl2)"/>
                <path d="M180,150 C160,100 120,60 80,40 C40,20 10,50 10,90 C10,130 40,160 80,165" fill="none" stroke="url(#tg2)" stroke-width="14" stroke-linecap="round" filter="url(#gl2)"/>
                <ellipse cx="200" cy="180" rx="70" ry="60" fill="url(#bg2)" filter="url(#gl2)"/>
                <ellipse cx="200" cy="145" rx="45" ry="40" fill="url(#bg2)"/>
                <ellipse cx="175" cy="175" rx="18" ry="22" fill="#0a0015"/>
                <ellipse cx="225" cy="175" rx="18" ry="22" fill="#0a0015"/>
                <ellipse cx="178" cy="172" rx="7" ry="9" fill="#bf5fff"/>
                <ellipse cx="228" cy="172" rx="7" ry="9" fill="#bf5fff"/>
                <circle cx="172" cy="168" r="4" fill="#fff" opacity="0.9"/>
                <circle cx="222" cy="168" r="4" fill="#fff" opacity="0.9"/>
            </svg>
            <div class="pin-title">Bienvenue !</div>
            <div class="pin-subtitle">Configuration initiale</div>
            <label style="color:#888;display:block;margin:15px 0 10px;">Votre num√©ro de membre :</label>
            <input type="number" id="setupMemberId" class="setup-input" placeholder="Ex: 1, 2, 3..." min="1" max="999">
            <label style="color:#888;display:block;margin-bottom:10px;">Code PIN (4 chiffres) :</label>
            <input type="password" id="setupPin" class="setup-input" maxlength="4" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢" inputmode="numeric">
            <div id="setupError" style="color:#ef4444;margin-bottom:10px;"></div>
            <button class="pin-btn" onclick="saveSetup()">‚úÖ Confirmer</button>
        </div>
    </div>
    
    <!-- Main App -->
    <div id="mainApp" class="container" style="display:none;">
        <div class="header">
            <svg class="octopus-logo-small" viewBox="0 0 400 400" xmlns="http://www.w3.org/2000/svg">
                <defs>
                    <radialGradient id="bg3" cx="50%" cy="30%" r="60%"><stop offset="0%" stop-color="#b366e8"/><stop offset="100%" stop-color="#4a0080"/></radialGradient>
                    <linearGradient id="tg3" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#9b4dca"/><stop offset="50%" stop-color="#6a1bb2"/><stop offset="100%" stop-color="#3d0066"/></linearGradient>
                    <filter id="gl3"><feGaussianBlur stdDeviation="2" result="coloredBlur"/><feMerge><feMergeNode in="coloredBlur"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
                </defs>
                <path d="M150,200 C100,180 50,220 30,280 C10,340 50,390 120,380 C180,370 220,340 250,300 C270,270 300,250 340,260 C380,270 395,310 380,350 C365,390 320,400 280,390" fill="none" stroke="url(#tg3)" stroke-width="22" stroke-linecap="round" filter="url(#gl3)"/>
                <path d="M150,200 C100,180 50,220 30,280 C10,340 50,390 120,380 C180,370 220,340 250,300 C270,270 300,250 340,260 C380,270 395,310 380,350 C365,390 320,400 280,390" fill="none" stroke="#2d0a4e" stroke-width="8" stroke-linecap="round" stroke-dasharray="2,15"/>
                <path d="M250,200 C300,180 350,150 370,100 C385,50 350,10 290,20 C230,30 180,60 150,100 C120,140 80,130 50,100 C20,70 10,30 30,10" fill="none" stroke="url(#tg3)" stroke-width="20" stroke-linecap="round" filter="url(#gl3)"/>
                <path d="M180,220 C150,260 100,300 80,350 C60,400 100,420 160,400 C220,380 280,400 340,420 C400,440 420,400 400,350" fill="none" stroke="url(#tg3)" stroke-width="18" stroke-linecap="round" filter="url(#gl3)"/>
                <path d="M260,190 C310,170 360,200 380,250 C400,300 390,360 350,380 C310,400 260,380 240,340" fill="none" stroke="url(#tg3)" stroke-width="16" stroke-linecap="round" filter="url(#gl3)"/>
                <path d="M140,190 C90,170 40,200 20,250 C0,300 10,360 50,380 C90,400 140,380 160,340" fill="none" stroke="url(#tg3)" stroke-width="16" stroke-linecap="round" filter="url(#gl3)"/>
                <path d="M200,150 C200,100 240,60 280,40 C320,20 370,40 380,80 C390,120 360,150 320,160" fill="none" stroke="url(#tg3)" stroke-width="14" stroke-linecap="round" filter="url(#gl3)"/>
                <path d="M180,150 C160,100 120,60 80,40 C40,20 10,50 10,90 C10,130 40,160 80,165" fill="none" stroke="url(#tg3)" stroke-width="14" stroke-linecap="round" filter="url(#gl3)"/>
                <ellipse cx="200" cy="180" rx="70" ry="60" fill="url(#bg3)" filter="url(#gl3)"/>
                <ellipse cx="200" cy="145" rx="45" ry="40" fill="url(#bg3)"/>
                <ellipse cx="175" cy="175" rx="18" ry="22" fill="#0a0015"/>
                <ellipse cx="225" cy="175" rx="18" ry="22" fill="#0a0015"/>
                <ellipse cx="178" cy="172" rx="7" ry="9" fill="#bf5fff"/>
                <ellipse cx="228" cy="172" rx="7" ry="9" fill="#bf5fff"/>
                <circle cx="172" cy="168" r="4" fill="#fff" opacity="0.9"/>
                <circle cx="222" cy="168" r="4" fill="#fff" opacity="0.9"/>
            </svg>
            <div class="title">OCTOPUS</div>
            <div class="subtitle">Communication Invisible par AION</div>
            <div class="badge">üîê ASEMANTIX ‚Äî Protocole Brevet√©</div>
        </div>
        
        <div class="protocol-info">
            <h4>üìã BREVET ASEMANTIX ‚Äî Validation Stricte</h4>
            <p><strong>16 marqueurs</strong> v√©rifi√©s avec <code>STRICTE √âGALIT√â (16/16)</code><br>
            <strong>Filtrage rapide :</strong> V√©rification AVANT d√©codage<br>
            <strong>Rejet :</strong> Si <code>1 seul</code> marqueur diff√®re ‚Üí Fragment IGNOR√â</p>
        </div>
        
        <div class="status-bar">
            <div id="statusBadge" class="status-badge disconnected"><span class="status-dot disconnected"></span><span id="statusText">D√©connect√©</span></div>
            <div class="member-id">Membre <span id="memberId">#?</span></div>
        </div>
        
        <div class="seed-section">
            <div class="section-title">üîë Graine Partag√©e (K‚ÇÄ)</div>
            <div class="seed-input-group">
                <input type="text" id="seedInput" placeholder="Collez la graine ou chargez un fichier">
                <input type="file" id="seedFileInput" accept=".octopus,.cameleon,.txt,.json">
                <button class="btn btn-primary" onclick="loadSeedFromInput()">‚úÖ Valider</button>
                <button class="btn btn-secondary" onclick="document.getElementById('seedFileInput').click()">üìÅ Fichier</button>
            </div>
            <div id="seedStatus" class="seed-status not-loaded">‚ö†Ô∏è Aucune graine ‚Äî Communication impossible</div>
        </div>
        
        <div class="chat-section">
            <div class="section-header">
                <div class="section-title">üí¨ Messages</div>
                <button class="btn btn-danger" onclick="clearMessages()">üóëÔ∏è Effacer</button>
            </div>
            <div class="messages-container" id="messagesContainer"><div class="no-messages">Chargez une graine pour communiquer</div></div>
            <div class="input-section">
                <textarea id="messageInput" class="message-input" placeholder="Tapez votre message..." rows="2" disabled></textarea>
                <button id="sendBtn" class="send-btn" onclick="sendMessage()" disabled>üì§ Envoyer</button>
            </div>
        </div>
        
        <div class="stats-section">
            <div class="section-title">üìä Statistiques</div>
            <div class="stats-grid">
                <div class="stat-item"><div class="stat-value" id="statSent">0</div><div class="stat-label">Envoy√©s</div></div>
                <div class="stat-item"><div class="stat-value" id="statReceived">0</div><div class="stat-label">Re√ßus</div></div>
                <div class="stat-item"><div class="stat-value" id="statValidated">0</div><div class="stat-label">Valid√©s (16/16)</div></div>
                <div class="stat-item"><div class="stat-value" id="statRejected">0</div><div class="stat-label">Rejet√©s</div></div>
                <div class="stat-item"><div class="stat-value" id="statIndex">1</div><div class="stat-label">Index</div></div>
            </div>
        </div>
        
        <div class="footer">
            <a href="index.html">‚Üê Retour</a>
            <a href="#" onclick="lockApp()">üîí Verrouiller</a>
            <a href="#" onclick="resetApp()">‚öôÔ∏è Reset</a>
            <p style="margin-top:10px;">¬© 2025 AION ASEMANTIX‚Ñ¢ ‚Äî L'invisible est ce qui constitue le visible</p>
        </div>
    </div>

<script>
const SERVER_URL = 'https://octopus-server-production-3f1e.up.railway.app';
const MARKER_COUNT = 16;
let socket = null, seed = null, memberId = null, messageIndex = 1, pairId = null;
let stats = { sent: 0, received: 0, validated: 0, rejected: 0 };
const receivedFragments = new Set();

function initApp() {
    const storedPin = localStorage.getItem('octopus_pin');
    const storedMemberId = localStorage.getItem('octopus_member_id');
    if (!storedPin || !storedMemberId) {
        document.getElementById('pinScreen').classList.add('hidden');
        document.getElementById('setupScreen').classList.remove('hidden');
    } else {
        document.getElementById('pinSetupText').textContent = 'Membre #' + storedMemberId;
    }
}

function saveSetup() {
    const mid = document.getElementById('setupMemberId').value.trim();
    const pin = document.getElementById('setupPin').value.trim();
    const err = document.getElementById('setupError');
    if (!mid || mid < 1) { err.textContent = 'Num√©ro invalide'; return; }
    if (!pin || pin.length !== 4 || !/^\d+$/.test(pin)) { err.textContent = 'PIN: 4 chiffres'; return; }
    localStorage.setItem('octopus_pin', pin);
    localStorage.setItem('octopus_member_id', mid);
    memberId = parseInt(mid);
    document.getElementById('setupScreen').classList.add('hidden');
    document.getElementById('pinScreen').classList.add('hidden');
    document.getElementById('mainApp').style.display = 'block';
    document.getElementById('memberId').textContent = '#' + memberId;
    connectToServer();
}

function checkPin() {
    const stored = localStorage.getItem('octopus_pin');
    const entered = document.getElementById('pinInput').value;
    if (entered === stored) {
        memberId = parseInt(localStorage.getItem('octopus_member_id'));
        document.getElementById('pinScreen').classList.add('hidden');
        document.getElementById('mainApp').style.display = 'block';
        document.getElementById('memberId').textContent = '#' + memberId;
        connectToServer();
    } else {
        document.getElementById('pinError').style.display = 'block';
        document.getElementById('pinInput').value = '';
    }
}

function lockApp() {
    document.getElementById('mainApp').style.display = 'none';
    document.getElementById('pinScreen').classList.remove('hidden');
    document.getElementById('pinInput').value = '';
    document.getElementById('pinError').style.display = 'none';
}

function resetApp() {
    if (confirm('R√©initialiser?')) { localStorage.clear(); location.reload(); }
}

document.getElementById('pinInput').addEventListener('keydown', e => { if (e.key === 'Enter') checkPin(); });

async function sha256(msg) {
    const buf = new TextEncoder().encode(msg);
    const hash = await crypto.subtle.digest('SHA-256', buf);
    return Array.from(new Uint8Array(hash)).map(b => b.toString(16).padStart(2,'0')).join('');
}

async function deriveMarkerPositions(seedHex, index) {
    const hash = await sha256(seedHex + ':marker:positions:' + index);
    const positions = [], used = new Set();
    for (let i = 0; i < 32 && positions.length < MARKER_COUNT; i++) {
        const pos = parseInt(hash.substr(i*2, 2), 16) % 256;
        if (!used.has(pos)) { used.add(pos); positions.push(pos); }
    }
    return positions.sort((a,b) => a-b);
}

async function deriveMarkerValues(seedHex, index) {
    const hash = await sha256(seedHex + ':marker:values:' + index);
    const values = [];
    for (let i = 0; i < MARKER_COUNT; i++) values.push(parseInt(hash.substr(i*2, 2), 16) % 2);
    return values;
}

async function fastFilter(fragmentHex, seedHex, index) {
    const positions = await deriveMarkerPositions(seedHex, index);
    const expected = await deriveMarkerValues(seedHex, index);
    const bits = hexToBits(fragmentHex);
    let matched = 0;
    for (let i = 0; i < MARKER_COUNT; i++) {
        if (parseInt(bits[positions[i]]) === expected[i]) matched++;
    }
    return { valid: matched === MARKER_COUNT, matched, total: MARKER_COUNT, positions, expected };
}

function generateRandomBits(len) {
    const bytes = new Uint8Array(Math.ceil(len/8));
    crypto.getRandomValues(bytes);
    let bits = '';
    for (const b of bytes) bits += b.toString(2).padStart(8,'0');
    return bits.substring(0, len);
}

function bitsToHex(bits) {
    let hex = '';
    for (let i = 0; i < bits.length; i += 4) hex += parseInt(bits.substr(i,4), 2).toString(16);
    return hex;
}

function hexToBits(hex) {
    let bits = '';
    for (const c of hex) bits += parseInt(c, 16).toString(2).padStart(4,'0');
    return bits;
}

async function encodeMessage(message, index) {
    const positions = await deriveMarkerPositions(seed, index);
    const values = await deriveMarkerValues(seed, index);
    const msgBytes = new TextEncoder().encode(message);
    let msgBits = '';
    for (const b of msgBytes) msgBits += b.toString(2).padStart(8,'0');
    const lenBits = msgBytes.length.toString(2).padStart(16,'0');
    let fragBits = generateRandomBits(256).split('');
    for (let i = 0; i < MARKER_COUNT; i++) fragBits[positions[i]] = values[i].toString();
    const payload = lenBits + msgBits;
    let pi = 0;
    for (let i = 0; i < 256 && pi < payload.length; i++) {
        if (!positions.includes(i)) { fragBits[i] = payload[pi]; pi++; }
    }
    return bitsToHex(fragBits.join(''));
}

async function decodeFragment(fragmentHex, positions) {
    const bits = hexToBits(fragmentHex);
    let payload = '';
    for (let i = 0; i < 256; i++) if (!positions.includes(i)) payload += bits[i];
    const len = parseInt(payload.substring(0,16), 2);
    if (len <= 0 || len > 100) return null;
    const msgBits = payload.substring(16, 16 + len*8);
    let msg = '';
    for (let i = 0; i < msgBits.length; i += 8) {
        const b = parseInt(msgBits.substr(i,8), 2);
        if (b > 0) msg += String.fromCharCode(b);
    }
    return msg;
}

function connectToServer() {
    socket = io(SERVER_URL, { transports: ['websocket', 'polling'] });
    socket.on('connect', () => { updateStatus(true); if (pairId) socket.emit('join', pairId); });
    socket.on('disconnect', () => updateStatus(false));
    socket.on('receive_fragment', async data => await handleFragment(data.fragment, data.senderId, Date.now()));
    socket.on('pending_fragments', async frags => { for (const f of frags) await handleFragment(f.fragment, f.senderId, f.timestamp); });
}

async function handleFragment(fragment, senderId, timestamp) {
    if (receivedFragments.has(fragment)) return;
    for (let idx = 1; idx <= 100; idx++) {
        const v = await fastFilter(fragment, seed, idx);
        if (v.valid) {
            receivedFragments.add(fragment);
            stats.validated++;
            const msg = await decodeFragment(fragment, v.positions);
            if (msg) {
                const mine = senderId === memberId;
                displayMessage(msg, fragment, senderId, mine, timestamp, v);
                if (!mine) stats.received++;
            }
            updateStats();
            return;
        }
    }
    stats.rejected++;
    updateStats();
}

function updateStatus(connected) {
    const badge = document.getElementById('statusBadge');
    const dot = badge.querySelector('.status-dot');
    const text = document.getElementById('statusText');
    badge.className = 'status-badge ' + (connected ? 'connected' : 'disconnected');
    dot.className = 'status-dot ' + (connected ? 'connected' : 'disconnected');
    text.textContent = connected ? 'Connect√©' : 'D√©connect√©';
}

async function loadSeedFromInput() {
    const val = document.getElementById('seedInput').value.trim();
    if (!val || val.length < 32) { alert('Graine invalide (min 32 car.)'); return; }
    seed = val;
    pairId = (await sha256(seed)).substring(0, 16);
    document.getElementById('seedInput').value = seed.substring(0,16) + '...' + seed.slice(-8);
    document.getElementById('seedStatus').className = 'seed-status';
    document.getElementById('seedStatus').innerHTML = '‚úÖ Graine charg√©e ‚Äî Protocole ASEMANTIX actif';
    document.getElementById('messageInput').disabled = false;
    document.getElementById('sendBtn').disabled = false;
    if (socket?.connected) socket.emit('join', pairId);
    document.getElementById('messagesContainer').innerHTML = '';
}

document.getElementById('seedFileInput').addEventListener('change', async e => {
    const file = e.target.files[0];
    if (!file) return;
    const text = await file.text();
    let data;
    try { data = JSON.parse(text); } catch { data = { seed: text.trim() }; }
    const s = data.seed || data.K0 || data.graine;
    if (s) {
        seed = s;
        pairId = data.pair_id || data.pairId || (await sha256(seed)).substring(0,16);
        document.getElementById('seedInput').value = seed.substring(0,16) + '...' + seed.slice(-8);
        document.getElementById('seedStatus').className = 'seed-status';
        document.getElementById('seedStatus').innerHTML = '‚úÖ Graine charg√©e ‚Äî Protocole ASEMANTIX actif';
        document.getElementById('messageInput').disabled = false;
        document.getElementById('sendBtn').disabled = false;
        if (socket?.connected) socket.emit('join', pairId);
        document.getElementById('messagesContainer').innerHTML = '';
    }
});

async function sendMessage() {
    const input = document.getElementById('messageInput');
    const msg = input.value.trim();
    if (!msg || !seed) return;
    const frag = await encodeMessage(msg, messageIndex);
    const v = await fastFilter(frag, seed, messageIndex);
    if (socket?.connected) socket.emit('send_fragment', { pairId, fragment: frag, senderId: memberId });
    displayMessage(msg, frag, memberId, true, Date.now(), v);
    stats.sent++; stats.validated++; messageIndex++;
    updateStats();
    input.value = '';
}

function displayMessage(msg, frag, senderId, isSent, ts, v) {
    const c = document.getElementById('messagesContainer');
    const ph = c.querySelector('.no-messages');
    if (ph) ph.remove();
    const d = document.createElement('div');
    d.className = 'message ' + (isSent ? 'sent' : 'received');
    const t = new Date(ts).toLocaleTimeString('fr-FR', {hour:'2-digit',minute:'2-digit'});
    d.innerHTML = '<div class="message-header">' + (isSent ? 'Vous' : 'Membre #'+senderId) + ' ‚Äî ' + t + '</div>' +
        '<div class="message-content">' + escapeHtml(msg) + '</div>' +
        '<div class="message-validation">‚úì Valid√© ' + v.matched + '/' + v.total + ' marqueurs (STRICT)</div>' +
        '<div class="message-fragment">Fragment: ' + frag.substring(0,32) + '...</div>';
    c.appendChild(d);
    c.scrollTop = c.scrollHeight;
}

function escapeHtml(t) { const d = document.createElement('div'); d.textContent = t; return d.innerHTML; }

function clearMessages() {
    if (confirm('Effacer tous les messages?')) {
        document.getElementById('messagesContainer').innerHTML = '<div class="no-messages">Aucun message</div>';
        receivedFragments.clear();
        stats = { sent: 0, received: 0, validated: 0, rejected: 0 };
        updateStats();
    }
}

function updateStats() {
    document.getElementById('statSent').textContent = stats.sent;
    document.getElementById('statReceived').textContent = stats.received;
    document.getElementById('statValidated').textContent = stats.validated;
    document.getElementById('statRejected').textContent = stats.rejected;
    document.getElementById('statIndex').textContent = messageIndex;
}

document.getElementById('messageInput').addEventListener('keydown', e => { if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); sendMessage(); } });

initApp();
</script>
</body>
</html>
